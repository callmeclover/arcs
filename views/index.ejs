<html>

<body>
  <%- include('partials/header.ejs'); -%>
    <div id="client">
      <div id="top-block">
        <% if (user) { %>
          <h1>Welcome, <%= user %>
          </h1>
          <% } %>
            <div id="chat-block">
              <div id="future">
              </div>
              <div id="chat-form">
                <form id="form" id="chat_form">
                  <input id="chat_input" type="text">
                  <input type="submit" value="Send">
                </form>
              </div>
            </div>
            <button id="dmbutton" onclick="darkmodetoggle()"><i class="bi bi-moon-stars-fill"
                style="font-size: xx-large;"></i></button>
            <button id="unamebutton" onclick="window.location = '/login'"><i class="bi bi-person-circle" style="font-size: xx-large;"></i></button>
            <div style=" display: flex; justify-content: center;"><img width="100" src="ARCS.png">
      </div>
      <script src="/assets/jquery.js"></script>
      <script src="/assets/socket.io.js"></script>
      <script>
        var user = document.cookie
          .split("; ")
          .find((row) => row.startsWith("user="))
          ?.split("%40")[1];
        var uname = document.cookie
          .split("; ")
          .find((row) => row.startsWith("uname="))
          ?.split("=")[1];
        if (uname == null || uname == "null" || uname == "") {
          window.location = "/login"
        }
        var socket = io.connect();
        socket.on('connect', function (data) {
          socket.emit('join', 'User joined.');
        });
        socket.on('broad', function (data) {
          $('#future').append(data);
        });

        $('form').submit(function (e) {
          e.preventDefault();
          var message = $('#chat_input').val();
          socket.emit('messages', [message, uname, user]);
        });

        function darkmodetoggle() {
          var e = document.body;
          var e1 = document.getElementById('chat-block')
          var e2 = document.getElementById('chat-form')
          var e3 = document.getElementById('future')
          var e4 = document.getElementById('dmbutton')
          var e5 = document.getElementById('unamebutton')
          e.classList.toggle("dark-mode");
          e1.classList.toggle("dark-mode-b");
          e2.classList.toggle("dark-mode-border-top");
          e3.classList.toggle("dark-mode-fut");
          e4.classList.toggle("dark-mode-dmbtn");
          e5.classList.toggle("dark-mode-dmbtn");
        }
      </script>
    </div>
    </div>
</body>

</html>